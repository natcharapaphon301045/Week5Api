@page "/studentlist"
@inject HttpClient Http
@inject NavigationManager NavigationManager
@using Week5.Application_Layer.DTOs

<!-- Top Bar -->
<div class="top-bar">
    Student List
</div>

<!-- Table for displaying students -->
@if (student == null)
{
    <p><em>Loading...</em></p>
}
else if (!student.Any())
{
    <p>No students available.</p>
}
else
{
    <div class="center-table">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Surname</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in student)
                {
                    <tr>
                        <td>@s.StudentID</td>
                        <td>@s.StudentName</td>
                        <td>@s.StudentSurname</td>
                        <td>
                            <button @onclick="() => ViewDetails(s.StudentID)">View Details</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    private List<StudentDTO>? student;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Fetch data from API
            var response = await Http.GetFromJsonAsync<ApiResponse<IEnumerable<StudentDTO>>>("https://localhost:5285/api/student");

            if (response != null && response.Success && response.Data != null)
            {
                student = response.Data.ToList();
            }
            else
            {
                // Handle error: Show message or log error
                student = new List<StudentDTO>(); // Default to empty list
            }
        }
        catch (Exception ex)
        {
            // Handle exception: Show error message
            Console.WriteLine($"Error fetching student data: {ex.Message}");
            student = new List<StudentDTO>(); // Default to empty list
        }
    }

    private void ViewDetails(int studentId)
    {
        // Navigate to the student details page
        NavigationManager.NavigateTo($"/studentdetails/{studentId}");
    }
}
